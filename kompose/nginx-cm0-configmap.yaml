apiVersion: v1
data:
  default.conf: "# HTTP to HTTPS redirect\nserver {\n    listen 80;\n    server_name 2jz.space;\n    return 301 https://$host$request_uri;\n}\n\n# HTTPS server block\nserver {\n    listen 443 ssl http2;\n    server_name 2jz.space;\n\n    # Let's Encrypt certificates\n    ssl_certificate /etc/letsencrypt/live/2jz.space/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/2jz.space/privkey.pem;\n    \n    # SSL settings\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers off;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Content-Type-Options nosniff;\n    add_header X-Frame-Options DENY;\n    add_header X-XSS-Protection \"1; mode=block\";\n    \n    root /usr/share/nginx/html;\n    index index.html;\n    \n    # Proxy API calls to Flask\n    location ~ ^/(products|health) {\n        proxy_pass http://app:5000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n}"
kind: ConfigMap
metadata:
  labels:
    io.kompose.service: nginx
  name: nginx-cm0
